<div class="card">
  <ng-container *ngIf="(result | async) === null; else resultContainer">
    <div [@inOutAnimation]>
      <div class="animating-container">
        <form [formGroup]="form" (submit)="processInteractiveQuery()">
          <div class="form-section">
            <div class="form-section-toolbar">
              <div class="form-section-name">Interactive Geocode</div>
            </div>

            <div class="form-section-body">
              <div class="form-collection row">
                <tamu-gisc-textbox [type]="'text'" [floatLabel]="true" [placeholder]="'Street Address'" formControlName="streetAddress"></tamu-gisc-textbox>
              </div>

              <div class="form-collection row">
                <tamu-gisc-textbox [type]="'text'" [floatLabel]="true" [placeholder]="'City'" formControlName="city"></tamu-gisc-textbox>
              </div>

              <div class="form-collection row">
                <tamu-gisc-select [placeholder]="'State'" [data]="states" [displayTemplate]="'name'" [valueTemplate]="'abbreviation'" formControlName="state"></tamu-gisc-select>
              </div>

              <div class="form-collection row">
                <tamu-gisc-textbox [type]="'number'" [floatLabel]="true" [placeholder]="'Zip'" formControlName="zip"></tamu-gisc-textbox>
              </div>

              <div class="form-collection row">
                <tamu-gisc-select [placeholder]="'Census Year'" [data]="censusIntersectionYears" [displayTemplate]="'name'" [valueTemplate]="'value'" formControlName="censusYears"></tamu-gisc-select>
              </div>

              <div class="form-collection column">
                <tamu-gisc-button [value]="buttonLanguage | async" [disabled]="form.invalid || (processing | async) === true" [type]="'submit'"></tamu-gisc-button>

                <div class="leader-2 flex flex-row justify-center">
                  <a href="" class="material-icons-container flex flex-row align-center"><span class="material-icons-outlined">settings</span> Advanced Options</a>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </ng-container>

  <ng-template #resultContainer>
    <div *ngIf="result | async as res" [@inOutAnimation]>
      <div class="animating-container">
        <tamu-gisc-tabs>
          <tamu-gisc-tab *ngFor="let gr of (result | async)?.data?.results" [label]="'Geocode'">
            <table>
              <thead>
                <tr>
                  <th>Field</th>
                  <th>Value</th>
                </tr>
              </thead>

              <tbody>
                <tr>
                  <td>Latitude</td>
                  <td>{{gr.latitude}}</td>
                </tr>

                <tr>
                  <td>Longitude</td>
                  <td>{{gr.longitude}}</td>
                </tr>

                <tr>
                  <td>Quality</td>
                  <td>{{gr.matchType}} {{gr.geocodeQualityType}}</td>
                </tr>

                <tr>
                  <td>Geocode Quality Type</td>
                  <td>{{gr.geocodeQualityType}}</td>
                </tr>

                <tr>
                  <td>NAACCR Census Tract Certainty Code</td>
                  <td>{{gr?.naaccr?.censusTractCertaintyCode}}</td>
                </tr>

                <tr>
                  <td>NAACCR Census Tract Certainty Name</td>
                  <td>{{gr?.naaccr?.censusTractCertaintyType}}</td>
                </tr>

                <tr>
                  <td>NAACCR GIS Coordinate Quality Code</td>
                  <td>{{gr?.naaccr?.gisCoordinateQualityCode}}</td>
                </tr>

                <tr>
                  <td>NAACCR GIS Coordinate Quality Name</td>
                  <td>{{gr?.naaccr?.gisCoordinateQualityType}}</td>
                </tr>

                <tr>
                  <td>Match Score</td>
                  <td>{{gr.matchScore}}</td>
                </tr>

                <tr>
                  <td>Micro Match Status</td>
                  <td>{{gr?.naaccr?.microMatchStatus}}</td>
                </tr>

                <tr>
                  <td>Penalty Code</td>
                  <td>{{gr?.naaccr?.penaltyCode}}</td>
                </tr>

                <tr>
                  <td>Penalty Code Summary</td>
                  <td>{{gr?.naaccr?.penaltyCodeSummary}}</td>
                </tr>

                <tr>
                  <td>Feature Matching Result Type</td>
                  <td>{{gr.featureMatchingResultType}}</td>
                </tr>

                <tr>
                  <td>Feature Matching Geography Type</td>
                  <td>{{gr.featureMatchingGeographyType}}</td>
                </tr>

                <tr>
                  <td>Matched Location Type</td>
                  <td>{{gr.matchedLocationType}}</td>
                </tr>
              </tbody>
            </table>
          </tamu-gisc-tab>

          <tamu-gisc-tab label="Map">
            <ng-container *ngIf="mapConfig | async as cnf">
              <tamu-gisc-esri-map [config]="cnf"></tamu-gisc-esri-map>
            </ng-container>
          </tamu-gisc-tab>
        </tamu-gisc-tabs>

        <div class="flex flex-row">
          <tamu-gisc-interactive-response-metadata [status]="res?.message" [guid]="res?.data?.transactionGuid" [timeTaken]="res?.data?.timeTaken" (resetTrigger)="clearResult()" (redirectTrigger)="navigateToResults()"></tamu-gisc-interactive-response-metadata>
        </div>
      </div>
    </div>
  </ng-template>
</div>
