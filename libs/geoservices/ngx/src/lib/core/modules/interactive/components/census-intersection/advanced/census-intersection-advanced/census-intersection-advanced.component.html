<div [@inOutAnimation]>
  <form [formGroup]="form" (submit)="processInteractiveQuery()">
    <div class="form-section">
      <div class="form-section-toolbar">
        <div class="form-section-name">
          <p>Geographic Location</p>
        </div>

        <div class="form-section-actions">
          <tamu-gisc-interactive-mode-toggle [mode]="componentMode | async" (modeChange)="toggleMode($event)"></tamu-gisc-interactive-mode-toggle>
        </div>
      </div>

      <div class="form-section-body">
        <div class="form-collection row">
          <tamu-gisc-textbox type="number" [floatLabel]="true" placeholder="Longitude (e.g. -118.397965182076)" formControlName="lon"></tamu-gisc-textbox>
        </div>

        <div class="form-collection row">
          <tamu-gisc-textbox type="number" [floatLabel]="true" placeholder="Latitude (e.g. 34.0726207994348)" formControlName="lat"></tamu-gisc-textbox>
        </div>

        <div class="form-collection row" *ngIf="(isAdvanced | async) === false">
          <tamu-gisc-select [placeholder]="'Census Year'" [data]="censusYears" [displayTemplate]="'name'" [valueTemplate]="'value'" formControlName="censusYear" [floatLabel]="true"></tamu-gisc-select>
        </div>

        <div class="form-collection row">
          <tamu-gisc-select placeholder="State (Optional)" [data]="states" displayTemplate="name" valueTemplate="abbreviation" formControlName="state" [floatLabel]="true"></tamu-gisc-select>
        </div>
      </div>
    </div>

    <div class="form-section" *ngIf="(isAdvanced | async)">
      <div class="form-section-toolbar">
        <div class="form-section-name">
          <p>Census Years</p>
        </div>
      </div>

      <div class="form-section-body">
        <div class="form-collection column">
          <p>Select all applicable return census years to intersect latitude and longitude with.</p>

          <tamu-gisc-checkbox-group formControlName="censusYear" [referenceId]="'value'">
            <tamu-gisc-checkbox *ngFor="let year of censusYears" [label]="year.name" [data]="year"></tamu-gisc-checkbox>
          </tamu-gisc-checkbox-group>
        </div>
      </div>
    </div>

    <div class="form-section">
      <div class="form-section-body">
        <div class="form-collection row">
          <tamu-gisc-button [value]="buttonLanguage | async" [disabled]="form.invalid || (processing | async) === true" [type]="'submit'"></tamu-gisc-button>
        </div>
      </div>
    </div>
  </form>
</div>

<ng-container *ngIf="(result | async) !== null && (resultError | async) === false;">
  <ng-container *ngIf="result | async as res">
    <div [@inOutAnimation] class="leader-3">
      <h2 class="section-header">Results</h2>

      <tamu-gisc-accordion [expanded]="true">
        <tamu-gisc-accordion-header>Transaction Details</tamu-gisc-accordion-header>
        <tamu-gisc-accordion-content>
          <tamu-gisc-status-result-table [status]="res.data"></tamu-gisc-status-result-table>
        </tamu-gisc-accordion-content>
      </tamu-gisc-accordion>

      <tamu-gisc-accordion *ngFor="let cr of (result | async)?.data?.results" [expanded]="true">
        <tamu-gisc-accordion-header>Census Year {{cr?.censusYear}}</tamu-gisc-accordion-header>
        <tamu-gisc-accordion-content>
          <tamu-gisc-census-intersection-result-table [address]="cr"></tamu-gisc-census-intersection-result-table>
        </tamu-gisc-accordion-content>
      </tamu-gisc-accordion>
    </div>
  </ng-container>
</ng-container>
