# pool:
#   vmImage: 'windows-latest'

pool:
  name: 'default'

jobs:
  - job: UESDispatchCI
    steps:
      - checkout: self
        clean: false
        fetchDepth: 1 # Fetch only one commit

      - task: NodeTool@0
        inputs:
          versionSpec: '12.18'
        displayName: 'Install Node.js'

      - script: npm i
        displayName: 'Clean dependencies'

      - script: |
          npx nx run ues-valves-angular:build --prod --baseHref /dispatch/ --skip-nx-cache
        displayName: 'Build ues-valves-angular (dispatch)'

      - task: CopyFiles@2
        inputs:
          Contents: 'dist/**'
          TargetFolder: '$(Build.ArtifactStagingDirectory)'
        displayName: 'Copy Distribution Files'

      - task: PublishBuildArtifacts@1
        inputs:
          pathtoPublish: $(Build.ArtifactStagingDirectory) # dist or build files
          ArtifactName: 'js-monorepo' # output artifact named www
        displayName: 'Publish Artifacts'
